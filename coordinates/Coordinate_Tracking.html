<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
  <Title> RCH 3rd Floor </title>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.3.min.js"></script>
    <script src="../dependencies/jquery.tabletoCSV.js" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript">

    function FindPosition(oElement)
    {
      if(typeof( oElement.offsetParent ) != "undefined")
      {
        for(var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent)
        {
          posX += oElement.offsetLeft;
          posY += oElement.offsetTop;
        }
        return [ posX, posY ];
      }
      else
      {
        return [ oElement.x, oElement.y ];
      }
    }

    function GetCoordinates(e)
    {
      var PosX = 0;
      var PosY = 0;
      var ImgPos;
      ImgPos = FindPosition(myImg);
      if (!e) var e = window.event;
      if (e.pageX || e.pageY)
      {
        PosX = e.pageX;
        PosY = e.pageY;
      }
      else if (e.clientX || e.clientY)
      {
        PosX = e.clientX + document.body.scrollLeft
        + document.documentElement.scrollLeft;
        PosY = e.clientY + document.body.scrollTop
        + document.documentElement.scrollTop;
      }
      PosX = PosX - ImgPos[0];
      PosY = PosY - ImgPos[1];

      document.getElementById("x").innerHTML = PosX;
      document.getElementById("y").innerHTML = PosY;

      var table = document.getElementById("coordinatesTable");
      var row = table.insertRow(1);
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      cell1.innerHTML = PosX;
      cell2.innerHTML = PosY;
      var roomNum = prompt("What's the room number?")
      if (roomNum != null) {
        cell3.innerHTML = roomNum;
      }
      var color = '#FF0000';
      var size = '5px';

      $("body").append(
        $('<div></div>')
        .css('position', 'absolute')
        .css('top', PosY + 'px')
        .css('left', PosX + 'px')
        .css('width', size)
        .css('height', size)
        .css('background-color', color)
      );
    }
    </script>

    <script>
        $(function(){
            $("#export").click(function(){
                $("#coordinatesTable").tableToCSV();
            });
        });
    </script>

  </head>

  <body>
    <img src="https://raw.githubusercontent.com/eginwong/uNav/master/coordinates/RCH_1stFloor.png?token=AL68V4BnmSOS3RRCqHMcZTmgdH3NyewHks5WomtVwA%3D%3D" id="myImgId" />
    <button id="export" data-export="export">Export</button>

    <script type="text/javascript">
    var myImg = document.getElementById("myImgId");
    myImg.onmousedown = GetCoordinates;
    </script>

    <br>
    <p hidden="">X:<span id="x" name="x_cor"></span></p>
    <p hidden="">Y:<span id="y" name="y_cor"></span></p>
    <table id="coordinatesTable">
      <tr>
        <th>X coordinate</th>
        <th>Y coordinate</th>
        <th>Room Number</th>
      </tr>
    </table>

  </body>
  </html>
