/*!CK:3506700372!*//*1456260048,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["dwmGI"]); }

__d("XBrowserPushDisabledController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/client\/push\/disabled\/",{});},null);
__d("XBrowserPushXOutController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/client\/push\/xout\/",{});},null);
__d("XServiceWorkerSessionChangeController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/service_workers\/session\/persist\/",{});},null);
__d('BrowserPushSessionChange.react',['AsyncRequest','BanzaiLogger','Image.react','ImageBlock.react','LayerFadeOnHide','React','ReactLayeredComponentMixin','ReloadPage','XBrowserPushDisabledController','XBrowserPushXOutController','XServiceWorkerSessionChangeController','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUISpinner.react','XUIText.react','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){if(c.__markCompiled)c.__markCompiled();var da=m.PropTypes,ea=m.createClass({displayName:'BrowserPushSessionChange',mixins:[n],propTypes:{onHide:da.func.isRequired,push:da.object.isRequired},getInitialState:function(){return {dialogShown:true,spin:false};},_onToggle:function(fa){if(fa)return;this.setState({dialogShown:false});this._logEvent('session_keep');var ga=r.getURIBuilder().getURI();new h().setURI(ga).setMethod('post').setData({app_id:this.props.push.appID}).setAllowCrossPageTransition(true).setHandler(function(ha){this.props.onHide();}.bind(this)).send();},_logEvent:function(event){var fa={event:event,appid:this.props.push.appID,surface:'session_change'};i.log('BrowserPushLoggerConfig',fa);},_doNotPersist:function(){this.setState({spin:true});this._logEvent('session_uninstall');this._logEvent('xout');var fa=q.getURIBuilder().getURI(),ga=function(){this.props.push.unregisterPushAndSW(p,h).then(function(ha){o.now();})['catch'](function(ha){throw ha;});}.bind(this);new h().setURI(fa).setMethod('post').setHandler(ga).setAllowCrossPageTransition(true).send();},componentDidMount:function(){this._logEvent('session_change_prompt');},renderLayers:function(){if(!this.state.dialogShown)return {};var fa=ca('/images/notifications/potsy_jump.png');return {dialog:m.createElement(s,{shown:true,behaviors:{LayerFadeOnHide:l},onToggle:this._onToggle,width:445},m.createElement(x,null,ba._("Desktop Notifications Are On")),m.createElement(t,null,this.state.spin?m.createElement(y,{size:'large'}):m.createElement(k,{spacing:'medium'},m.createElement(j,{src:fa,alt:ba._("Desktop Notifications Are On")}),m.createElement('div',null,m.createElement('div',{className:"_3-8h"},m.createElement(z,{size:'large'},ba._("When you get a new notification, you'll see it in the corner of your screen."))),m.createElement('div',{className:"_3-8h"},m.createElement(z,{size:'small'},ba._("To be sure you get notifications, you'll now stay logged into Facebook on this computer. If you're using a public computer or don't want to stay logged in, click Undo to turn off desktop notifications.")))))),m.createElement(v,null,m.createElement(u,{action:'button',label:ba._("Undo"),onClick:this._doNotPersist}),m.createElement(w,{use:'confirm',action:'cancel'})))};},render:function(){return (m.createElement('span',null));}});f.exports=ea;},null);
__d('NotificationPermissionNotice.react',['Event','Keys','React','ReactLayeredComponentMixin','XUIAmbientNUX.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=[],p=j.PropTypes,q=j.createClass({displayName:'NotificationPermissionNotice',mixins:[k],propTypes:{onHide:p.func.isRequired,shortText:p.bool,browserName:p.string.isRequired},componentDidMount:function(){o.push(h.listen(window,'mousedown',this.props.onHide));o.push(h.listen(window,'keydown',function(event){if(event.keyCode===i.ESC)this.props.onHide();}.bind(this)));},componentWillUnmount:function(){while(o.length>0){var r=o.pop();r.remove();}},renderLayers:function(){var r=this.props.shortText?n._("Click the lock to give {browser_name} permission to send you desktop notifications.",[n.param('browser_name',this.props.browserName)]):n._("If you change your mind, click the lock to give {browser_name} permission to send you desktop notifications.",[n.param('browser_name',this.props.browserName)]);return {nux:j.createElement(l,{contextRef:function(){return this.refs.noticeAnchor;}.bind(this),shown:true,position:'below',onCloseButtonClick:this.props.onHide},r)};},render:function(){return (j.createElement('span',{ref:'noticeAnchor',className:"_1_i1"}));}});f.exports=q;},null);
__d('Spotlight',['Arbiter','ArbiterMixin','DOM','JSXDOM','Layer','LayerAutoFocus','LayerTabIsolation','ModalLayer','Vector','classWithMixins','csx','cx','joinClasses','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w;if(c.__markCompiled)c.__markCompiled();v=babelHelpers.inherits(x,q(l,u(i)));w=v&&v.prototype;function x(z,aa){'use strict';w.constructor.call(this,z,aa);this.stageMinSize=new p(0,0);this.stagePadding=new p(0,0);}x.prototype._buildWrapper=function(z,aa){'use strict';var ba=t("_n8 _3qx",z.rootClassName);return (k.div({className:ba},k.div({className:"_n9"},aa)));};x.prototype._getDefaultBehaviors=function(){'use strict';return w._getDefaultBehaviors.call(this).concat([y,m,n,o]);};x.prototype.getContentRoot=function(){'use strict';if(!this._content)this._content=j.find(this.getRoot(),"div._n3");return this._content;};x.prototype.configure=function(z){'use strict';if(z.stageMinSize)this.stageMinSize=z.stageMinSize;if(z.stagePadding)this.stagePadding=z.stagePadding;};x.prototype.onContentLoaded=function(){'use strict';this.inform('content-load');};x.prototype.updatePermalink=function(z){'use strict';this.inform('permalinkchange',z);};Object.assign(x.prototype,{stageMinSize:null,stagePadding:null});function y(z){'use strict';this._layer=z;}y.prototype.enable=function(){'use strict';this._subscription=this._layer.subscribe(['show','hide'],function(z,aa){if(z==='show'){h.inform('layer_shown',{type:'Spotlight'});}else h.inform('layer_hidden',{type:'Spotlight'});});};y.prototype.disable=function(){'use strict';this._subscription.unsubscribe();this._subscription=null;};Object.assign(y.prototype,{_subscription:null});f.exports=x;},null);
__d('Spotlight.react',['LayerHideOnBlur','LayerHideOnEscape','ReactLayer','Spotlight'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=j.createClass({getDefaultEnabledBehaviors:function(){return {hideOnBlur:h,hideOnEscape:i};},createLayer:function(m){var n=this.enumerateBehaviors(this.props.behaviors),o={addedBehaviors:n,rootClassName:this.props.rootClassName},p=new k(o,m);p.conditionShow(this.props.shown);if(this.props.onBeforeHide)p.subscribe('beforehide',this.props.onBeforeHide);if(this.props.onHide)p.subscribe('hide',this.props.onHide);return p;},receiveProps:function(m){this.layer.conditionShow(m.shown);}});f.exports=l;},null);
__d('NotificationPermissionRequest.react',['Spotlight.react','React','ReactLayeredComponentMixin','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m=i.createClass({displayName:'NotificationPermissionRequest',mixins:[j],propTypes:{onHide:l.func.isRequired},renderLayers:function(){return {spotlight:i.createElement(h,{shown:true,onHide:this.props.onHide},i.createElement('div',{className:"_n3"}))};},render:function(){return i.createElement('span',null);}});f.exports=m;},null);
__d('BrowserPushCommands',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='browser_push_ack',i='browser_push_redirect',j='browser_push_window_visible',k={ACK:h,REDIRECT:i,WINDOW_VISIBLE:j};f.exports=k;},null);
__d('BrowserPushMessageHandler',['BrowserPushCommands','EventListener','isFacebookURI','URISchemes'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(event){if(event.data.command&&event.data.command===h.REDIRECT){if(typeof window.onbeforeunload()==='undefined'){event.ports[0].postMessage({command:h.ACK,success:true});}else{event.ports[0].postMessage({command:h.ACK,success:false});return;}var n=event.data.uri;if(/^([^.:/?#]+):/.test(n)&&!k.isAllowed(/^([^.:/?#]+):/.exec(n)[0])&&j(n))throw new Error('goURI: URI scheme rejected, URI: '+n);window.location.href=n;}}var m={registerRedirectHandler:function(){i.listen(window,'message',function(event){if(event.origin==="")l(event);});if(navigator.serviceWorker&&navigator.serviceWorker.addEventListener)navigator.serviceWorker.addEventListener('message',function(event){if(new RegExp('^'+window.location.protocol+'//'+window.location.host+'$').test(event.origin))l(event);});}};f.exports=m;},null);
__d('BrowserPushVisibilityChanger',['BrowserPushCommands','ClientServiceWorkerMessage','Visibility'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){new i(h.WINDOW_VISIBLE,null).sendViaController();}var l={listenForVisibility:function(){if(!j.isHidden())k();j.addListener(j.VISIBLE,k);}};f.exports=l;},null);
__d('PushRegistration',['Promise','BrowserPushMessageHandler','BrowserPushVisibilityChanger','ClientServiceWorkerMessage','Map','ServiceWorkerRegistration'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=window.Notification,o=new l();p.get=function(q,r){'use strict';if(o.has(r))return o.get(r);var s=new p(q,r);o.set(r,s);return s;};function p(q,r){'use strict';this.$PushRegistration3=q;this.appID=r;if(!p.$PushRegistration1&&!p.$PushRegistration2){p.$PushRegistration1=false;p.$PushRegistration2=false;}}p.prototype.getPushSubscription=function(){'use strict';return new h(function(q,r){if(!n||n.permission==='denied')r(new Error('No permission or not supported'));m.getWorkerRegistration(this.$PushRegistration3).then(function(s){if(!s){q(null);return;}s.pushManager.getSubscription().then(function(t){q(t);})['catch'](r);})['catch'](r);}.bind(this));};p.prototype.$PushRegistration4=function(q){'use strict';var r=q.endpoint;if('subscriptionId' in q&&!new RegExp('/'+q.subscriptionId+'$').test(r))r+='/'+q.subscriptionId;return r;};p.prototype.$PushRegistration5=function(q,r,s,t){'use strict';var u=this.$PushRegistration4(s),v=null;if(s.getKey){var w=Array.from(new Uint8Array(s.getKey('p256dh'))),x=String.fromCharCode.apply(null,w);v=window.btoa(x);}var y=q.getURIBuilder().getURI(),z=new r(y);z.setData({app_id:this.appID,push_endpoint:u,endpoint_key:v});z.setMethod('post');if(z.setHandler)z.setHandler(function(aa){if(aa.payload&&aa.payload.session_change)t();});z.send();};p.prototype.getSubscription=function(){'use strict';return new h(function(q,r){this.getPushSubscription().then(function(s){if(s){q(this.$PushRegistration4(s));}else q(null);}.bind(this))['catch'](r);}.bind(this));};p.prototype.maybeRegisterPushAgain=function(q,r,s){'use strict';return new h(function(t,u){this.getPushSubscription().then(function(v){if(v){this.$PushRegistration5(q,r,v,s);t(this.$PushRegistration4(v));}else t(null);}.bind(this))['catch'](function(){t(null);});}.bind(this));};p.prototype.$PushRegistration6=function(q,r,s){'use strict';return new h(function(t,u){if(p.$PushRegistration2&&!s){u(new Error('sending disable info already'));return;}p.$PushRegistration2=true;var v=q.getURIBuilder().getURI(),w=new r(v.toString());w.setData({appid:this.appID,from_browser_settings:s});w.setMethod('post');if(w.listen){w.listen('finally',t);w.listen('fail',function(){p.$PushRegistration2=false;u();});}else if(w.setErrorHandler&&w.setHandler){w.setErrorHandler(function(){p.$PushRegistration2=false;u();});w.setHandler(t);}else t();w.send();}.bind(this));};p.prototype.isPushRegistered=function(q,r,s,t,u,v){'use strict';i.registerRedirectHandler();return new h(function(w,x){this.getPushSubscription().then(function(y){w(!!y||q&&!p.pushPermissionIsPending());if(y){if(u){y.unsubscribe().then(function(){this.registerPush(r,t,v);}.bind(this))['catch'](function(){});}else j.listenForVisibility();}else if(!y&&q)if(p.pushPermissionIsOn()){this.registerPush(r,t,v)['catch'](function(){});}else this.$PushRegistration6(s,t,false);}.bind(this))['catch'](function(){if(q){this.$PushRegistration6(s,t,false);x();}}.bind(this));}.bind(this));};p.prototype.$PushRegistration7=function(){'use strict';return new h(function(q,r){n.requestPermission(q);});};p.prototype.registerPushAndWaitForEndpoint=function(q,r,s){'use strict';return new h(function(t,u){this.$PushRegistration8(q,r,s,true,null).then(function(v){if(typeof v!=='string'){u(new Error('registerPushImpl did not return an endpoint'));return;}t(v);})['catch'](u);}.bind(this));};p.prototype.registerPush=function(q,r,s){'use strict';return this.registerPushWithFinishedCallBack(q,r,s,null);};p.prototype.registerPushWithFinishedCallBack=function(q,r,s,t){'use strict';return new h(function(u,v){this.$PushRegistration8(q,r,s,false,t).then(function(w){if(typeof w!=='boolean'){v(new Error('registerPushImpl did not return a boolean'));return;}u(w);})['catch'](v);}.bind(this));};p.prototype.$PushRegistration8=function(q,r,s,t,u){'use strict';if(p.$PushRegistration1)return new h(function(v,w){w(new Error('registering already'));});p.$PushRegistration1=true;return new h(function(v,w){var x=m.registerWorkerIfUnregistered(this.$PushRegistration3),y=this.$PushRegistration7();h.all([x,y]).then(function(z){var aa=z[0];if(!p.pushPermissionIsOn()){aa.unregister();throw new Error('Push permission was denied');}if(!t)v(true);aa.pushManager.subscribe({userVisibleOnly:true}).then(function(ba){if(t)v(this.$PushRegistration4(ba));this.$PushRegistration5(q,r,ba,s);if(u)u();j.listenForVisibility();}.bind(this))['catch'](function(ba){p.$PushRegistration1=false;aa.unregister();w(ba);});}.bind(this))['catch'](function(z){p.$PushRegistration1=false;w(z);});}.bind(this));};p.prototype.$PushRegistration9=function(q,r){'use strict';return new h(function(s,t){this.$PushRegistration6(q,r,true).then(function(){var u=new k('unregister',{},s);u.sendViaController();})['catch'](t);}.bind(this));};p.prototype.unregisterPushAndSW=function(q,r){'use strict';return new h(function(s,t){this.$PushRegistration6(q,r,true).then(function(){m.getWorkerRegistration(this.$PushRegistration3).then(function(u){if(u){u.pushManager.getSubscription().then(function(v){v.unsubscribe().then(function(){u.unregister().then(s).reject(t);})['catch'](function(){s(true);});})['catch'](function(){s(true);});}else u.unregister().then(s).reject(t);})['catch'](t);}.bind(this))['catch'](t);}.bind(this));};p.pushPermissionIsPending=function(){'use strict';return n&&n.permission==='default';};p.pushPermissionIsOn=function(){'use strict';return n&&n.permission==='granted';};f.exports=p;},null);
__d("XPushRegisterServiceWorkerController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/push\/register\/service_worker\/",{});},null);
__d('BrowserPushDirectPromptInstaller',['Arbiter','AsyncRequest','BanzaiLogger','BrowserPushSessionChange.react','DOM','NotificationPermissionNotice.react','NotificationPermissionRequest.react','PushRegistration','React','ReactDOM','XBrowserPushDisabledController','XBrowserPushXOutController','XPushRegisterServiceWorkerController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=false;function v(event,z){var aa={event:event,appid:z,surface:'prompt'};j.log('BrowserPushLoggerConfig',aa);}function w(z){if(!u){u=true;q.unmountComponentAtNode(z);}}function x(z,aa){var ba=l.insertBefore(z,l.create('span')),ca=ba.pop();q.render(p.createElement(k,{onHide:function(){q.unmountComponentAtNode(z);},push:aa}),ca);}var y={installPush:function(z,aa,ba,ca,da,ea,fa){var ga=o.get(z,aa);ga.isPushRegistered(ca,t,r,i,!!ea,function(){x(ba,ga);}).then(function(ha){if(ha||da)return;if(o.pushPermissionIsPending())q.render(p.createElement(n,{onHide:function(){w(ba);}}),ba);v('turn_on',aa);ga.registerPushWithFinishedCallBack(t,i,function(){x(ba,ga);},function(){h.inform('BrowserPushInstall/installed');}).then(function(){w(ba);v('install',aa);})['catch'](function(ia){w(ba);if(window.Notification&&window.Notification.permission==='denied'){q.render(p.createElement(m,{onHide:function(){q.unmountComponentAtNode(ba);},browserName:fa}),ba);v('deny',aa);}else v('install_ignore',aa);var ja=s.getURIBuilder().getURI();new i().setURI(ja).setMethod('post').send();v('xout',aa);});})['catch'](function(){});}};f.exports=y;},null);
__d("XBrowserPushMuteController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/client\/push\/mute\/",{push_endpoint:{type:"String",required:true},appid:{type:"Int",required:true},is_settings_page:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d('BrowserPushMuteOptions',['AsyncRequest','PushRegistration','React','ReactDOM','XBrowserPushMuteController','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();function n(p,q,r){var s=i.get(q,r);s.getPushSubscription().then(function(t){if(t){var u=l.getURIBuilder().setString('push_endpoint',t.endpoint).setInt('appid',r).getURI();new h().setURI(u).setRelativeTo(p).send();}})['catch'](function(t){throw t;});}var o={showMuteOptions:function(p,q,r){if(!i.pushPermissionIsOn())return;k.render(j.createElement('a',{href:'#',onClick:function(){n(p,q,r);}},m._("Mute")),p);}};f.exports=o;},null);